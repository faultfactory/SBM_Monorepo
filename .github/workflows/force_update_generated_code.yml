# This is a basic workflow to help you get started with Actions

name: manual_update_autogenerated_can

# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
 generate_c_interface:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3
      - uses: vweevers/multi-checkout-action@v1
        with:
      # Newline-separated repositories in the form of `owner/name` (to checkout the default branch) or `owner/name@ref` where `ref` is a branch name, tag or SHA to checkout.
          repositories: howerj/dbcc
      
      # Runs a single command using the runners s
      - name: build_dbcc
        run: | 
          cd $GITHUB_WORKSPACE/../howerj/dbcc
          make

      # Runs a set of commands using the runners shell
      - name: Generate .h and .c files from dbc
        run: |
          mkdir -p $GITHUB_WORKSPACE/can_conv
          cd $GITHUB_WORKSPACE/../howerj/dbcc
          ./dbcc -v -o $GITHUB_WORKSPACE/can_conv $GITHUB_WORKSPACE/dbc/*.dbc 
          
      - name: Git commit / Push Changes
        uses: actions-x/commit@v6
        with:
          message: "Automated CAN interface file update"
          files: can_conv/*
